<section class="phx-hero">
  <span>Puoi iscriverti a due workshop dall'elenco, il numero di posti Ã¨ limitato, quindi pensaci bene ma non esitare troppo!</span>
</section>

<section class="row">
  <article class="column">
    <table>
      <tbody>
    <%= for chunk <- Enum.sort(@workshops, &(&1.hub <= &2.hub)) |> Enum.chunk_by(&(&1.hub)) do %>
      <tr><td colspan="3"><h2 style="margin-bottom: 0"><%= Enum.at(chunk, 0).hub %></h2></td></tr>
    <%= for workshop <- chunk do %>
        <tr class="no-border">
          <td class="no-border"><strong><%= workshop.name %></strong></td>
          <td class="no-border"><%= workshop.max_slots - Enum.count(workshop.iscrizioni) %>/<%= workshop.max_slots %></td>
          <td align="right" class="no-border"><%= workshop.begins %> - <%= workshop.ends %></td>
        </tr>
        <tr>
          <td colspan="3" style="padding-bottom: 12px;">
          <div class="riga-descrizione">
              <p>
                <%= workshop.description %>
              </p>
              <%= if is_iscritto?(@conn, workshop.id) do %>
                    <%=
                        button "Annulla iscrizione",
                        to: Routes.iscrizione_path(
                            @conn,
                            :delete,
                            workshop.id),
                            method: :delete,
                            data: [confirm: "Sei sicuro/a?"]
                    %>
                <%= else %>
                    <%= if workshop.max_slots > Enum.count(workshop.iscrizioni) and can_signup?(@conn) do %>
                            <%=
                                button "Iscriviti",
                                to: Routes.iscrizione_path(
                                    @conn,
                                    :create,
                                    %{"iscrizione":
                                        %{workshop_id: workshop}
                                    }),
                                    method: :post
                            %>
                    <% end %>
                <%= end %>
            </div>
            </td>
        </tr>
    <% end %>
    <% end %>
      </tbody>
    </table>
  </article>
</section>
